<template name="database">
  {{> databaseSearch}}
</template>

<template name="databaseSearch">
  <h1>Search</h1>
  <input type="text" name="searchDatabase" class="form-control" placeholder="Search for a card name, race, or description">
  {{#if searching}}
    <p>searching...</p>
  {{else}}
    {{#if results}}
      <div class="database-results">
        {{#each results}}
        {{> databaseCard layout="cardResult" info=this query=query}}
        {{> databaseCard layout="pageModal" info=this}}
        {{/each}}
      </div>
    {{else}}
      {{#if query}}
        <p class="alert alert-warning">Nothing found for <code>{{query}}</code></p>
      {{/if}}
    {{/if}}
  {{/if}}
</template>

<template name="highlightQuery">
  {{highlighted}}
</template>

<template name="databaseCard">
  {{#if cardResult}}
  <a data-remodal-target="{{slugifiedName}}" class="db-card remodal-trigger" data-type="{{this.info.type}}">
    <div class="mana-cost"><span class="value">{{this.info.manaCost}}</span></div>
    <div class="sprite">
      <div class="card-sprite {{#if this.info.health}}group_idle{{else}}group_passive{{/if}} card-id_{{this.info.id}}"></div>
    </div>
    <div class="card-caption">
      <div class="name"><span class="value">{{> highlightQuery text=this.info.name query=query}}</span></div>
      <p class="type">
        <span class="value">{{> highlightQuery text=this.info.race query=query}}</span>
      </p>
      <p class="rarity {{this.info.rarity}}"><span class="value">{{this.info.rarity}}</span></p>
      {{#if this.info.health}}
      <ul class="stats">
          <li class="stat-property stat-atk">
              <span class="value">{{this.info.attack}}</span>
          </li>
          <li class="stat-property stat-hp">
              <span class="value">{{this.info.health}}</span>
          </li>
      </ul>
      {{/if}}
    </div>
    <p class="card-description"><span class="value">{{> highlightQuery text=this.info.description keywords=true query=query}}</span></p>
  </a>
  {{/if}}
  {{#if pageModal}}
  <div class="remodal" data-remodal-id="{{slugifiedName}}">
    <button data-remodal-action="close" class="remodal-close"></button>
    {{> databaseCardPage info=this.info}}
  </div>
  {{/if}}
  {{#if pageModalCard}}
  <div class="db-card" data-type="{{this.info.type}}">
    <div class="mana-cost"><span class="value">{{this.info.manaCost}}</span></div>
    <div class="sprite">
      <div class="card-sprite {{#if this.info.health}}group_idle{{else}}group_passive{{/if}} card-id_{{this.info.id}}"></div>
    </div>
    <div class="card-caption">
      <div class="name"><span class="value">{{this.info.name}}</span></div>
      <p class="type">
        <span class="value">{{this.info.race}}</span>
      </p>
      <p class="rarity {{this.info.rarity}}"><span class="value">{{this.info.rarity}}</span></p>
      {{#if this.info.health}}
      <ul class="stats">
          <li class="stat-property stat-atk">
              <span class="value">{{this.info.attack}}</span>
          </li>
          <li class="stat-property stat-hp">
              <span class="value">{{this.info.health}}</span>
          </li>
      </ul>
      {{/if}}
    </div>
    <p class="card-description"><span class="value">{{parsedDescription}}</span></p>
  </div>
  {{/if}}
  {{#if historicalCard}}
  <div class="db-card" data-type="{{this.info.type}}">
    <div class="mana-cost">
      <span class="value">{{this.info.manaCost}}</span>
      <span class="value">{{{this.info.manaCostDiffAdd}}}</span>
      <span class="value">{{{this.info.manaCostDiffRemove}}}</span>
    </div>
    <div class="sprite">
      <div class="card-sprite {{#if this.info.health}}group_idle{{else}}group_passive{{/if}} card-id_{{this.info.id}}"></div>
    </div>
    <div class="card-caption">
      <div class="name"><span class="value">{{this.info.name}}</span></div>
      <div class="name"><span class="value">{{{this.info.nameDiffAdd}}}</span></div>
      <div class="name"><span class="value">{{{this.info.nameDiffRemove}}}</span></div>
      <p class="type"><span class="value">{{this.info.race}}</span></p>
      <p class="type"><span class="value">{{{this.info.raceDiffAdd}}}</span></p>
      <p class="type"><span class="value">{{{this.info.raceDiffRemove}}}</span></p>
      <p class="rarity {{this.info.rarity}}"><span class="value">{{this.info.rarity}}</span></p>
      {{#if this.info.health}}
      <ul class="stats">
          <li class="stat-property stat-atk">
              <span class="value">{{this.info.attack}}</span>
          </li>
          <li class="stat-property stat-hp">
              <span class="value">{{this.info.health}}</span>
          </li>
      </ul>
      {{/if}}
    </div>
    <p class="card-description"><span class="value">{{parsedDescription}}</span></p>
    <p class="card-description"><span class="value">{{{this.info.descriptionDiffRemove}}}</span></p>
    <p class="card-description"><span class="value">{{{this.info.descriptionDiffAdd}}}</span></p>
  </div>
  {{/if}}
  {{#unless this.layout}}
  <div class="db-card" data-type="{{this.info.type}}">
    <div class="mana-cost"><span class="value">{{this.info.manaCost}}</span></div>
    <div class="sprite">
      <div class="card-sprite {{#if this.info.health}}group_idle{{else}}group_passive{{/if}} card-id_{{this.info.id}}"></div>
    </div>
    <div class="card-caption">
      <div class="name"><span class="value">{{this.info.name}}</span></div>
      <p class="type">
        <span class="value">{{this.info.race}}</span>
      </p>
      <p class="rarity {{this.info.rarity}}"><span class="value">{{this.info.rarity}}</span></p>
      {{#if this.info.health}}
      <ul class="stats">
          <li class="stat-property stat-atk">
              <span class="value">{{this.info.attack}}</span>
          </li>
          <li class="stat-property stat-hp">
              <span class="value">{{this.info.health}}</span>
          </li>
      </ul>
      {{/if}}
    </div>
    <p class="card-description"><span class="value">{{parsedDescription}}</span></p>
  </div>
  {{/unless}}
</template>

<template name="databaseCardPage">
  <div class="page-content">
    <h1>{{this.info.name}}</h1>
    {{> databaseCard layout="pageModalCard" info=this.info}}
    <h2>Patch History</h2>
    {{#if Template.subscriptionsReady}}
    {{#each patchCards}}
    {{> databaseCard info=this layout="historicalCard"}}
    {{/each}}
    {{/if}}
  </div>
</template>
