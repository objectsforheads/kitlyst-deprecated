<template name="databasePatchPage">
  {{> databaseNav}}
  {{#if Template.subscriptionsReady}}
  {{loadSprites}}
  <div class="patch-page database-page content-container">
    <h1>Patch {{patchNumber}}</h1>
    {{#if patchGenerals}}
      <div class="patch-generals">
        <h2>Generals</h2>
        <div class="patch-changes">
          {{#with patchGenerals}}
          {{#if this.added}}
          <h4>Added</h4>
          <div class="card-container">
            {{#each this.added}}
            <div class="card-wrapper">
              <a href="/database/cards/{{this.id}}">{{> databaseCard info=this layout="historicalCard"}}</a>
            </div>
            {{/each}}
            <div class="card-wrapper grid-force"></div>
            <div class="card-wrapper grid-force"></div>
            <div class="card-wrapper grid-force"></div>
            <div class="card-wrapper grid-force"></div>
          </div>
          {{/if}}
          {{#if this.changed}}
          <h4>Changed</h4>
          <div class="patch-changes">
            {{#each this.changed}}
            <div>
              <div class="patch-change">
                {{#each patchChanges}}
                <div class="patch-card {{#if this.added}}new{{/if}}">
                  <p class="patch-number">from <a href="/database/patches/{{patch}}">{{patch}}</a></p>
                  <a href="/database/cards/{{this.id}}">{{> databaseCard info=this layout="historicalCard"}}</a>
                </div>
                {{/each}}
              </div>
            </div>
            {{/each}}
          </div>
          {{/if}}
          {{/with}}
        </div>
      </div>
    {{/if}}
    <div class="patch-cards">
      <h2>Cards</h2>
      {{#each expansions}}
        {{#if patchCards}}
        <h3>{{this}}</h3>
        {{#with patchCards}}
        {{#if this.added}}
        <h4>Added</h4>
        <div class="card-container">
          {{#each this.added}}
          <div class="card-wrapper">
            <a href="/database/cards/{{this.id}}">{{> databaseCard info=this layout="historicalCard"}}</a>
          </div>
          {{/each}}
          <div class="card-wrapper grid-force"></div>
          <div class="card-wrapper grid-force"></div>
          <div class="card-wrapper grid-force"></div>
          <div class="card-wrapper grid-force"></div>
        </div>
        {{/if}}
        {{#if this.changed}}
        <h4>Changed</h4>
        <div class="patch-changes">
          {{#each this.changed}}
          <div>
            <div class="patch-change">
              {{#each patchChanges}}
              <div class="patch-card {{#if this.added}}new{{/if}}">
                <p class="patch-number">from <a href="/database/patches/{{patch}}">{{patch}}</a></p>
                <a href="/database/cards/{{this.id}}">{{> databaseCard info=this layout="historicalCard"}}</a>
              </div>
              {{/each}}
            </div>
          </div>
          {{/each}}
        </div>
        {{/if}}
        {{/with}}
        {{/if}}
      {{/each}}
    </div>
  </div>
  {{/if}}
</template>
