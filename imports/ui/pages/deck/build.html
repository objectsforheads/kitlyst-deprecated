<template name="deckBuild">
  <style class="deckbuilder-search-styles"></style>
  {{#if generalSelected}}
  <div class="deckbuilder-container {{#if statsEnabled}}hide-add-cards{{/if}}">
    {{> addCards}}
    {{#if statsEnabled}}
      {{> drawStats}}
    {{/if}}
  </div>
  {{> navDeckInfo}}
  {{> navDeckbuilderSettings}}
  {{> navDeckbuilderFilters}}
  {{else}}
    <h1>Build a Deck</h1>
    <div class="select-general">
      {{> selectGeneral}}
    </div>
  {{/if}}
</template>

<template name="builderStateToggle">
  {{#if statsAvailable}}
  <div class="builder-state-toggles">
    <label for="builder-state_cards" class="builder-state-toggle">
      <input type="radio" name="builder-state" value="false" checked id="builder-state_cards">
      <i class="fa fa-book"></i>
    </label>
    <label for="builder-state_stats" class="builder-state-toggle">
      <input type="radio" name="builder-state" value="true" id="builder-state_stats">
      <i class="fa fa-bar-chart"></i>
    </label>
  </div>
  {{/if}}
</template>

<template name="navDeckInfo">
  <div class="deck-info fixed-nav">
    {{> builderStateToggle}}
    <label for="deck-info-toggle" class="toggle">
      <input type="checkbox" id="deck-info-toggle" class="deck-info-toggle toggle-checkbox"/>
      <i class="fa fa-expand"></i>
      <f class="fa fa-compress"></f>
    </label>
    <div class="deck-info-wrapper fixed-nav-wrapper">
      <div class="deck-stats">
        <h3>Deck</h3>
        {{> deckStats}}
      </div>
      <div class="deck-mods">
        {{> deckMods}}
      </div>
      {{> deckList}}
    </div>
  </div>
</template>

<template name="navDeckbuilderSettings">
  <div class="deckbuilder-settings fixed-nav">
    <label for="deckbuilder-settings-toggle" class="toggle">
      <input type="checkbox" id="deckbuilder-settings-toggle" class="deckbuilder-settings-toggle toggle-checkbox"/>
      <i class="fa fa-cog"></i>
    </label>
    <div class="deckbuilder-settings-wrapper fixed-nav-wrapper">
      <h2>Settings</h2>
      <h3>View</h3>
      <ul>
        <li><a href="#" class="set-deckbuilder-view" data-view="layout-full">Card View</a></li>
        <li><a href="#" class="active set-deckbuilder-view" data-view="layout-min">Minimum View</a></li>
      </ul>
    </div>
  </div>
</template>

<template name="navDeckbuilderFilters">
  <div class="deckbuilder-filters fixed-nav">
    <label for="deckbuilder-filters-toggle" class="toggle">
      <input type="checkbox" id="deckbuilder-filters-toggle" class="deckbuilder-filters-toggle toggle-checkbox"/>
      <i class="fa fa-sliders"></i>
    </label>
    <div class="deckbuilder-filters-wrapper fixed-nav-wrapper">
      <h2>Search</h2>
      <div class="deckbuilder-search-wrapper">
        <input type="text" class="deckbuilder-search">
        <i class="fa fa-search"></i>
      </div>
      <h2>Filters</h2>
      <h3>Type</h3>
      <div class="deckbuilder-filter_options">
        <label for="type-filter_artifact" class="filter_type check-enabled">
          <input type="checkbox" id="type-filter_artifact" value="Artifact" checked>
          <i class="fa fa-eye is-enabled"></i>
          <i class="fa fa-eye-slash is-disabled"></i>
          <div class="filter-label">Artifact</div>
        </label>
        <label for="type-filter_spell" class="filter_type check-enabled">
          <input type="checkbox" id="type-filter_spell" value="Spell" checked>
          <i class="fa fa-eye is-enabled"></i>
          <i class="fa fa-eye-slash is-disabled"></i>
          <div class="filter-label">Spell</div>
        </label>
        <label for="type-filter_unit" class="filter_type check-enabled">
          <input type="checkbox" id="type-filter_unit" value="Unit" checked>
          <i class="fa fa-eye is-enabled"></i>
          <i class="fa fa-eye-slash is-disabled"></i>
          <div class="filter-label">Unit</div>
        </label>
      </div>
      <div class="range-filter-label">
        <h3>Mana Cost</h3>
        <div class="check-enabled">
          <label for="range-filter_manaCost" class="filter_type check-enabled">
            <input type="checkbox" id="range-filter_manaCost" value="Artifact">
            <i class="fa fa-eye is-enabled"></i>
            <i class="fa fa-eye-slash is-disabled"></i>
          </label>
        </div>
      </div>
      <div class="deckbuilder-filter_range">
        <div class="filter_manaCost" id="filter_manaCost" disabled></div>
      </div>
      <div class="range-filter-label">
        <h3>Attack</h3>
        <div class="check-enabled">
          <label for="range-filter_attack" class="filter_type check-enabled">
            <input type="checkbox" id="range-filter_attack" value="Artifact">
            <i class="fa fa-eye is-enabled"></i>
            <i class="fa fa-eye-slash is-disabled"></i>
          </label>
        </div>
      </div>
      <div class="deckbuilder-filter_range">
        <div class="filter_attack" id="filter_attack" disabled></div>
      </div>
      <div class="range-filter-label">
        <h3>Health</h3>
        <div class="check-enabled">
          <label for="range-filter_health" class="filter_type check-enabled">
            <input type="checkbox" id="range-filter_health" value="Artifact">
            <i class="fa fa-eye is-enabled"></i>
            <i class="fa fa-eye-slash is-disabled"></i>
          </label>
        </div>
      </div>
      <div class="deckbuilder-filter_range">
        <div class="filter_health" id="filter_health" disabled></div>
      </div>
    </div>
  </div>
</template>

<template name="deckList">
  <h3>Cards</h3>
  <div class="deck-list">
    <div class="deck-list-wrapper">
      {{#each deckCards}}
      <div class="decklist-card">
        {{> card info=this layoutType="layout-list" hasTooltip=true}}
        <div class="decklist-card-info">
          <div class="decklist-card-caption">
            <span class="decklist-card-name">{{name}}</span><span class="decklist-card-count"> x{{count}}</span>
          </div>
          <div class="decklist-card-options">
            <button class="modCardCount removeCard-1"><i class="fa fa-minus-circle"></i></button>
            <button class="modCardCount addCard-1"><i class="fa fa-plus-circle"></i></button>
            <button class="modCardCount removeCard-all"><i class="fa fa-ban"></i></button>
          </div>
        </div>
      </div>
      {{/each}}
    </div>
  </div>
</template>

<template name="deckMods">
  {{#each deckGeneral}}
  <div class="decklist-card deck-general">
    {{> card info=this layoutType="layout-list" hasTooltip=true}}
    <div class="decklist-card-info">
      <div class="decklist-card-caption">
        <span class="decklist-card-name">{{name}}</span>
      </div>
      <div class="decklist-card-options">
        <button class="modDeck changeGeneral"><i class="fa fa-exchange"></i></button>
        <button class="modDeck deleteDeck"><i class="fa fa-trash"></i></button>
      </div>
    </div>
  </div>
  <div class="tooltip-wrapper">
    {{> card info=this classes="card-tooltip" layoutType="layout-full" isTooltip=true}}
  </div>
  {{/each}}
</template>

<template name="deckStats">
  <div class="ct-chart ct-double-octave deckstat-manaCost" id="deckstat-manaCost"></div>
  <div class="type-counts">
    <div class="type-count">
      <span class="type-count-value">
        {{typeUnitCount}}
      </span>
      <strong>Units</strong>
    </div>
    <div class="type-count">
      <span class="type-count-value">
        {{typeSpellCount}}
      </span>
      <strong>Spells</strong>
    </div>
    <div class="type-count">
      <div class="type-count-value">
        {{typeArtifactCount}}
      </div>
      <strong>Artifacts</strong>
    </div>
  </div>
  <div class="deck-meta">
    <div class="deck-card-count">
      <span class="deck-card-count-value {{#if overDeckCardCount}}warn_too-many-cards{{/if}}">{{deckCardCount}}</span>/<strong>40</strong>
    </div>
    <div class="crafting-cost">
      <strong>Crafting Cost:</strong> <span class="crafting-cost-value">{{spiritCost}}</span>
    </div>
  </div>
</template>

<template name="displayTwoDropDistribution">
  <div id="drawstat-twoDropDist" class="ct-chart ct-double-octave drawstat-twoDropDist">
  </div>
</template>

<template name="displayStartDrawDistribution">
  <div class="startDraw-chart-wrapper">
    <div class="startDraw-labels-flex">
      <div class="startDraw-labels">
        {{#each labels}}
          {{> card info=this hasTooltip=true layoutType="layout-list"}}
        {{/each}}
      </div>
    </div>
    <div class="startDraw-chart">
      <div id="drawstat-startDrawDist_{{cardCount}}" class="ct-chart ct-double-octave drawstat-startDrawDist_{{cardCount}}">
      </div>
    </div>
  </div>
</template>

<template name="turn1PlayChance">
  <div class="t1Play-stats-wrapper">
    <div class="t1Play-deck">
      <h4>Your Deck</h4>
      <div class="t1Play-deck-cards" id="t1Play-deck-cards">
        {{#each deck}}
          {{> card info=this hasTooltip=false layoutType="layout-list"}}
        {{/each}}
      </div>
    </div>
    <div class="t1Play-play">
      <h4>Your Hand</h4>
      <div class="t1Play-play-cards" id="t1Play-play-cards">
        {{#each play}}
          {{> card info=this hasTooltip=false layoutType="layout-list"}}
        {{/each}}
      </div>
    </div>
    <div class="t1Play-stats">
      <h4>Draw Chance</h4>
      {{#if play}}
        {{t1PlayChance}}
      {{else}}
      <p>Calculate your turn 1 draw chance by dragging and dropping cards from your deck into your hand</p>
      {{/if}}
    </div>
  </div>
</template>

<template name="turn1Hands">
  <p>Currently showing <span class="draw-stat-value">{{count}}</span> sample hands.</p>
  <div class="turn1Hand-hands">
    {{#each hands}}
      <div class="turn1Hand-hand">
        <h4>Game {{this}}</h4>
        {{#each hand}}
        {{> card info=this hasTooltip=false layoutType="layout-list"}}
        {{/each}}
      </div>
    {{/each}}
  </div>
</template>

<template name="cardDrawDistribution">
  <div class="cardDraw-chart-wrapper">
    <div class="cardDraw-labels-flex">
      <div class="cardDraw-labels">
        {{#each labels}}
          {{> card info=this hasTooltip=true layoutType="layout-list"}}
        {{/each}}
      </div>
    </div>
    <div class="cardDraw-chart">
      <div id="drawstat-cardDrawDist_{{cardCount}}" class="ct-chart ct-double-octave drawstat-cardDrawDist_{{cardCount}}">
      </div>
    </div>
  </div>
</template>

<template name="winConditionDistribution">
  <div class="winCondition-stats-wrapper">
    <div class="winCondition-condition">
      <div class="winCondition-deck">
        <h4>Your Deck</h4>
        <div class="winCondition-deck-cards" id="winCondition-deck-cards">
          {{#each deck}}
            {{> card info=this hasTooltip=false layoutType="layout-list"}}
          {{/each}}
        </div>
      </div>
      <div class="winCondition-play">
        <h4>Your Hand</h4>
        <div class="winCondition-play-cards" id="winCondition-play-cards">
          {{#each play}}
            {{> card info=this hasTooltip=false layoutType="layout-list"}}
          {{/each}}
        </div>
      </div>
    </div>
    <h3>Distributions</h3>
    <div class="winCondition-stats">
      {{#each startHands}}
        {{> winConditionStats}}
      {{/each}}
    </div>
  </div>
</template>

<template name="winConditionStats">
  <div class="winCondition-turn-condition"><span class="hand-count">Hand has {{handCount}}/{{playCount}} Cards on turn </span><input type="text" class="turn-count" value="1"/></div>
  <div class="winCondition-hand-wrapper">
    {{#each this}}
      {{> winConditionHand}}
    {{/each}}
  </div>
    <div id="drawstat-winCondition_{{handCount}}" class="ct-chart ct-double-octave drawstat-winCondition_{{handCount}} {{#unless handSelected}}hidden{{/unless}}"></div>
  {{#unless handSelected}}
    <ul>
      <li>Select a hand to calculate the draw distribution</li>
    </ul>
  {{/unless}}
</template>

<template name="winConditionHand">
  <div class="winCondition-hand">
    {{#if step}}
      <p>Possible hand</p>
      <div class="winCondition-hand-cards">
        {{#each step}}
          {{> card info=this hasTooltip=false layoutType="layout-list"}}
        {{/each}}
      </div>
    {{else}}
      <p>Have not drawn any win condition cards</p>
    {{/if}}
    {{#if incomplete}}
      <p>Still need to draw</p>
      <div class="winCondition-missing-cards">
        {{#each missing}}
          {{> card info=this hasTooltip=false layoutType="layout-list"}}
        {{/each}}
      </div>
    {{/if}}
  </div>
</template>

<template name="drawStats">
  <h1>Stats</h1>
  <h2>Turn 1</h2>
  <p>
    With <span class="draw-stat-value">{{twoDropCount}}</span> 2-drops in your deck, you have a <span class="draw-stat-value">{{twoDropStat}}</span> chance of drawing at least one of them on turn 1 (taking advantage of your mulligan and replacing on open).
  </p>
  <h3>2-drop count distribution</h3>
  <p>The number of 2-drops you're likely to draw on turn 1 (not including your opening replace)</p>
  {{> displayTwoDropDistribution}}
  <h3>starting draw distribution</h3>
  <p>The likelihood of drawing a particular card on turn 1 (with mulligan and opening replace)</p>
  {{#each startDropData}}
    {{> displayStartDrawDistribution}}
  {{/each}}
  <h3>turn 1 hand chance</h3>
  <p>The likelihood you'll draw into your ideal turn 1 hand (not including your opening replace)</p>
  {{> turn1PlayChance}}
  <h3>sample turn 1 hands</h3>
  {{> turn1Hands}}
  <h2>Card Draw</h2>
  <h3>card draw distribution</h3>
  <p>The likelihood of drawing a certain card by a certain turn (including your mulligan and replacing whenever possible)</p>
  {{#each startDropData}}
    {{> cardDrawDistribution}}
  {{/each}}
  <h3>win condition draw distribution</h3>
  <p>The likelihood of drawing your win condition cards by a certain turn (including your mulligan and replacing whenever possible)</p>
  <p>Win conditions are slightly more complicated. To read this data, first navigate to the chart that shows your starting hand and select that hand to show your chance of drawing/replacing into another card you need for your win condition. For instance:</p>
  <ul>
    <li>Of a win condition containing 3 cards, you draw only 1 of them in your starting hand.</li>
    <li>Selecting the appropriate hand under the chart, <code>Hand has 1/3 Cards</code>, will generate a graph showing the likelihood of drawing another card in your win condition.</li>
  </ul>
  <p>You can modify this chart to show you distributions later on in the game (ie. when you've drawn more cards) by changing the <code>turn</code> setting. For instance:</p>
  <ul>
    <li>Of a win condition containing 2 cards, you draw none of them in your starting hand. The chart, <code>Hand has 0/3 Cards</code>, shows the likelihood of drawing another card in your win condition.</li>
    <li>On turn 4, you draw one of them. The chart, <code>Hand has 1/3 Cards</code>, with a <code>turn</code> setting of <code>5</code> (you drew into this scenario on turn 4) will show you the likelihood of drawing the final card.</li>
  </ul>
  {{> winConditionDistribution}}
</template>

<template name="addCards">
  <div class="add-cards-wrapper">
    <h1>Build a Deck</h1>
    <div class="deckbuilder" data-layout="layout-min" data-showArtifacts="true" data-showSpells="true" data-showUnits="true">
      <div class="add-cards">
        <h2>Add Cards</h2>
        <h3>Faction Cards</h3>
        <div class="deckbuilder-cards">
          {{#each availableFactionCards}}
            {{> card info=this classes="addCard deckbuilder-card" maxCount="3" hasTooltip=true}}
          {{/each}}
        </div>
        <h3>Neutral Cards</h3>
        <div class="deckbuilder-cards">
        {{#each availableNeutralCards}}
        {{> card info=this classes="addCard deckbuilder-card" maxCount="3" hasTooltip=true}}
        {{/each}}
        </div>
        <div class="tooltip-wrapper">
          {{#each availableFactionCards}}
            {{> card info=this classes="card-tooltip" layoutType="layout-full" isTooltip=true}}
          {{/each}}
          {{#each availableNeutralCards}}
            {{> card info=this classes="card-tooltip" layoutType="layout-full" isTooltip=true}}
          {{/each}}
        </div>
      </div>
    </div>
  </div>
</template>

<template name="selectGeneral">
  <h2>Select your General</h2>
  <div class="generals animated">
    {{#each factions}}
    {{passFaction}}
      {{#each factionGenerals faction=getFaction}}
        {{> card info=this classes="general-choice" layoutType="layout-full"}}
      {{/each}}
    {{/each}}
  </div>
</template>
